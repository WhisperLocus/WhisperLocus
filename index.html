<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8">
    <title>WhisperLocus</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">

    <script src='https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.css' rel='stylesheet' />
    
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@600&display=swap" rel="stylesheet">
    
<style>
/* ---------------------------------------------------- */
/* åŸºç¤ä½ˆå±€ */
/* ---------------------------------------------------- */
*, ::before, ::after { box-sizing: border-box; }

html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100vh;
    overflow: hidden; 
    background-color: #f0f0f0;
}

#map-container {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 100%;
    z-index: 1;
}

/* ---------------------------------------------------- */
/* å·¦ä¸Šè§’æ§åˆ¶é¢æ¿ */
/* ---------------------------------------------------- */
#left-top-controls {
    position: absolute;
    z-index: 10; 
    top: 20px; 
    left: 20px; 
    width: 240px; 
    max-width: 90%;
    pointer-events: none;
}

#left-top-controls > * {
    pointer-events: auto;
}

#logo-header {
    margin-bottom: 20px;
    text-shadow: 0 0 10px rgba(255,255,255,0.8);
}

#main-logo {
    font-family: 'Cormorant Garamond', serif;
    font-size: 36px;
    font-weight: 600; 
    color: #333;
    margin: 0;
    line-height: 1;
    cursor: pointer;
    display: inline-block;
    transition: opacity 0.2s;
}

#main-logo:hover {
    opacity: 0.7;
}

#sub-slogan {
    font-family: 'Arial', sans-serif;
    font-size: 15px;
    color: #666;
    margin: 5px 0 0 0;
}

#leave-post-link {
    display: block;
    width: 100%;
    background-color: #ff5722; 
    color: white; 
    text-decoration: none;
    padding: 12px; 
    border-radius: 8px;
    font-weight: normal; 
    text-align: center;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
    margin-bottom: 12px;
    transition: transform 0.2s, background-color 0.2s;
}

#leave-post-link:hover {
    background-color: #e64a19;
    transform: translateY(-2px);
}

#code-input {
    width: 100%; 
    padding: 12px; 
    font-size: 14px;
    border-radius: 8px; 
    border: 1px solid rgba(0,0,0,0.1); 
    background: white; 
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); 
    text-align: center;
    outline: none;
}

#code-search-message {
    font-size: 12px; 
    color: #ff5722;
    margin-top: 8px;
    text-align: center;
    font-weight: bold;
    min-height: 18px;
    transition: opacity 0.8s ease;
    opacity: 1;
}

/* ---------------------------------------------------- */
/* ğŸ¯ About èªªæ˜é¢æ¿æ¨£å¼ (åŠé€æ˜èƒŒæ™¯ + æ·±è‰²æ–‡å­—) */
/* ---------------------------------------------------- */
#about-panel {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    transition: opacity 0.4s ease;
}

#about-panel.hidden {
    display: none;
    opacity: 0;
}

.about-content {
    position: relative;
    max-width: 700px;
    width: 90%;
    max-height: 85vh;          /* é™åˆ¶æœ€å¤§é«˜åº¦ç‚ºè¢å¹•çš„ 85% */
    padding: 50px 40px;
    color: #1a1a1a;
    font-family: 'Arial', sans-serif;
    line-height: 1.8;
    text-align: center;
 
    /* ğŸ“œ é–‹å•Ÿæ²è»¸åŠŸèƒ½ */
    overflow-y: auto;          
    background: rgba(255, 255, 255, 0.2); /* æ·¡æ·¡çš„å…§æ¡†æ„Ÿ */
    border-radius: 15px;
}

/* âœ¨ è‡ªå®šç¾©æ²è»¸æ¨£å¼ (è®“å®ƒè®Šç´°ã€ä¸çªå…€) */
.about-content::-webkit-scrollbar {
    width: 4px;
}

.about-content::-webkit-scrollbar-track {
    background: transparent;
}

.about-content::-webkit-scrollbar-thumb {
    background: rgba(0, 0, 0, 0.1);
    border-radius: 10px;
}

.about-content::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 0, 0, 0.3);
}
/* è®“æ®µè½é–“è·æ›´æœ‰å±¤æ¬¡ */
.about-content p {
    margin-bottom: 28px;
    font-size: 16px;
    letter-spacing: 0.3px;
}
/* ç§»å‹•ç«¯å¾®èª¿ï¼šç¸®å°å…§è·ä»¥çˆ­å–ç©ºé–“ */
@media (max-width: 480px) {
    .about-content {
        padding: 40px 20px;
        width: 95%;
    }
}

.about-highlight {
    margin-top: 35px;
    font-style: italic;
    color: #000;
    font-weight: bold;
}

#about-close {
    position: absolute;
    top: 0;
    right: 0;
    background: none;
    border: none;
    font-size: 40px;
    cursor: pointer;
    color: #333;
    padding: 20px;
    line-height: 1;
}

/* ---------------------------------------------------- */
/* Popup ä¾¿åˆ©è²¼æ¨£å¼ */
/* ---------------------------------------------------- */
.custom-memo-popup .mapboxgl-popup-content {
    background-color: #FFFEF9 !important;
    border-radius: 2px !important;
    box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.2) !important;
    padding: 0 !important;
    width: 300px !important;
    min-height: 250px !important;
    display: flex;
    flex-direction: column;
}

@media (max-width: 480px) {
    .custom-memo-popup .mapboxgl-popup-content { width: 80vw !important; }
}

.emotion-popup-content-wrapper {
    padding: 35px 20px 40px 25px;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    position: relative;
    height: 100%;
}

.memo-content-text {
    font-size: 15px;
    line-height: 1.7;
    color: #333;
    white-space: pre-wrap;
    word-break: break-word;
    margin: 10px 0;
    overflow-y: auto;
    max-height: 200px;
}

.popup-code-label { position: absolute; top: 10px; left: 15px; font-size: 11px; color: #999; font-family: Arial, sans-serif; }
.popup-location-label { position: absolute; bottom: 10px; left: 15px; font-size: 11px; color: #777; font-family: Arial, sans-serif; }
.popup-bottom-right { position: absolute; bottom: 10px; right: 15px; font-size: 11px; color: #999; font-family: Arial, sans-serif;}

</style>
</head>

<body>
    <div id="map-container"></div> 
    
    <div id="left-top-controls">
        <div id="logo-header">
            <h1 id="main-logo" title="Click for About">WhisperLocus</h1>
            <p id="sub-slogan">For the words we never got to say.</p>
        </div>

        <a href="post.html" id="leave-post-link">
            Leave a whisper.
        </a>
        
        <form id="code-search-form">
            <input type="text" id="code-input" placeholder="Search by Code" maxlength="8" required autocomplete="off">
            <div id="code-search-message"></div>
        </form>
    </div>

    <div id="about-panel" class="hidden">
        <div class="about-content">
            <button id="about-close" title="Close">&times;</button>
            <div id="about-text-container"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { 
            getFirestore, 
            collection, 
            getDocs, 
            doc, 
            deleteDoc, 
            query, 
            where, 
            serverTimestamp 
        } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDFED1K3dpMYaUpj8DlJWI1SnqgfFWzy44",
            authDomain: "whisperlocus.firebaseapp.com",
            projectId: "whisperlocus",
            storageBucket: "whisperlocus.firebasestorage.app",
            messagingSenderId: "801292984890",
            appId: "1:801292984890:web:0c064b4c206a8000f84b03",
            measurementId: "G-TCB2PWSN1C"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
      
        window.db = db;
        window.collection = collection;
        window.getDocs = getDocs;
        window.doc = doc;
        window.deleteDoc = deleteDoc;
        window.query = query;
        window.where = where;
        window.serverTimestamp = serverTimestamp;

        console.log("ğŸ”¥ Firebase Ready");
    </script>

    <script src="map.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- 1. å¤šåœ‹èªè¨€æ–‡å­—è³‡æ–™åº« ---
            const translations = {
                'zh': `
                    <p>WhisperLocus æ˜¯ä¸€å€‹å…¬é–‹çš„åŒ¿ååœ°åœ–ã€‚
                    <p>å®ƒç‚ºé‚£äº›æœªæ›¾æ‰¾åˆ°åˆé©æ™‚æ©Ÿèªªå‡ºå£çš„<br>æ€ç·’ã€è¨˜æ†¶èˆ‡æƒ…æ„Ÿè€Œå­˜åœ¨ã€‚</p>
                    <p>æ¯ä¸€å‰‡è²¼æ–‡éƒ½æ˜¯åŒ¿åçš„ï¼Œ<br>æ¯ä¸€å‰‡è²¼æ–‡éƒ½æ˜¯å…¬é–‹çš„ã€‚<br>å®ƒå€‘éŒ¨å®šæ–¼ç‰¹å®šçš„ç©ºé–“ï¼Œ<br>åƒ…ç”±å”¯ä¸€çš„ä»£ç¢¼æ¨™è¨˜ã€‚</p>
                    <p>é€™è£¡æ²’æœ‰å€‹äººæª”æ¡ˆã€æ²’æœ‰è©•è«–ï¼Œä¹Ÿæ²’æœ‰å›è¦†ã€‚
                    <p>è‹¥è²¼æ–‡åŒ…å«é‡å°æ€§çš„å‚·å®³ã€<br>éœ²éª¨å»£å‘Šæˆ–åˆ»æ„æ¿«ç”¨ï¼Œ<br>å¯èƒ½æœƒè¢«å¯©æ ¸æˆ–ç§»é™¤ã€‚<br>å¯©æ ¸çš„å­˜åœ¨æ˜¯ç‚ºäº†å®ˆè­·é€™ç‰‡å¯§éœã€‚</p>
                    <p class="about-highlight">ä½ å¯ä»¥ä¸åœ¨é€™è£¡ç•™ä¸‹ä»»ä½•æ±è¥¿ï¼Œ<br>åƒ…åƒ…åªæ˜¯ç€è¦½ä¹Ÿæ˜¯æ²’å•é¡Œçš„ã€‚</p>
                `,
                'en': `
                    <p>WhisperLocus is a public, anonymous map<br>where words are placed, not exchanged.</p>
                    <p>It exists for thoughts, memories, and feelings<br>that never found the right moment to be spoken.</p>
                    <p>Every post is anonymous. Every post is public.<br>Each one is anchored to a place, marked only by a unique code.</p>
                    <p>There are no profiles, no comments, and no replies.<br>This is not a space for debate, persuasion, or promotion.</p>
                    <p>Some posts may be moderated or removed if they contain targeted harm, explicit advertising, or deliberate misuse of the space.</p>
                    <p>Moderation exists to protect the quiet,<br>not to shape what should be felt.</p>
                    <p class="about-highlight">You donâ€™t have to leave anything here.<br>Youâ€™re allowed to just look.</p>
                `
                ,
                'fr': `
                    <p>WhisperLocus est une carte publique et anonyme<br>oÃ¹ les mots sont dÃ©posÃ©s, non Ã©changÃ©s.</p>
                    <p>Elle existe pour les pensÃ©es, les souvenirs et les sentiments<br>qui n'ont jamais trouvÃ© le moment propice pour Ãªtre exprimÃ©s.</p>
                    <p>Chaque publication est anonyme. Chaque publication est publique.<br>Chaque publication est ancrÃ©e Ã  un lieu, marquÃ© uniquement par un code unique.</p>
                    <p>Il n'y a pas de profils, pas de commentaires, pas de rÃ©ponses.<br>Ce n'est pas un espace de dÃ©bat, de persuasion ou de promotion.</p>
                    <p>Certaines publications peuvent Ãªtre modÃ©rÃ©es ou supprimÃ©es si elles contiennent des propos malveillants, de la publicitÃ© explicite ou un usage abusif de l'espace.</p>
                    <p>La modÃ©ration est lÃ  pour prÃ©server le silence,<br>et non pour influencer les sentiments.</p>
                    <p class="about-highlight">Vous n'Ãªtes pas obligÃ© de publier quoi que ce soit.<br>Vous pouvez simplement regarder.</p>
                `
                ,
                'jp': `
                    <p>WhisperLocus ã¯ã€è¨€è‘‰ãŒäº¤ã‚ã•ã‚Œã‚‹ã®ã§ã¯ãªãã€ç½®ã‹ã‚Œã‚‹ã€å…¬é–‹ã•ã‚ŒãŸåŒ¿åã®åœ°å›³ã§ã™ã€‚</p>
                    <p>ã“ã“ã¯ã€è¨€è‘‰ã«ã™ã‚‹ã¹ãç¬é–“ãŒãªã‹ã£ãŸè€ƒãˆã€è¨˜æ†¶ã€ãã—ã¦æ„Ÿæƒ…ã®ãŸã‚ã«å­˜åœ¨ã—ã¾ã™ã€‚</p>
                    <p>ã™ã¹ã¦ã®æŠ•ç¨¿ã¯åŒ¿åã§ã™ã€‚ã™ã¹ã¦ã®æŠ•ç¨¿ã¯å…¬é–‹ã•ã‚Œã¾ã™ã€‚<br>ãã‚Œãã‚Œã®æŠ•ç¨¿ã¯å ´æ‰€ã«ç´ä»˜ã‘ã‚‰ã‚Œã€å›ºæœ‰ã®ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦ã®ã¿ãƒãƒ¼ã‚¯ã•ã‚Œã¾ã™ã€‚</p>
                    <p>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã€ã‚³ãƒ¡ãƒ³ãƒˆã€è¿”ä¿¡ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>ã“ã“ã¯è­°è«–ã€èª¬å¾—ã€å®£ä¼ã®ãŸã‚ã®ç©ºé–“ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                    <p>ç‰¹å®šã®äººç‰©ã¸ã®å±å®³ã€éœ²éª¨ãªåºƒå‘Šã€ã¾ãŸã¯æ„å›³çš„ãªç©ºé–“ã®æ‚ªç”¨ã‚’å«ã‚€æŠ•ç¨¿ã¯ã€ãƒ¢ãƒ‡ãƒ¬ãƒ¼ãƒˆã¾ãŸã¯å‰Šé™¤ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</p>
                    <p>ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯é™å¯‚ã‚’å®ˆã‚‹ãŸã‚ã«å­˜åœ¨ã—ã€<br>äººã€…ã®æ„Ÿæƒ…ã‚’å½¢ä½œã‚‹ãŸã‚ã«å­˜åœ¨ã™ã‚‹ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                    <p class="about-highlight">ã“ã“ã«ä½•ã‚‚æ®‹ã™å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>ãŸã è¦‹ã‚‹ã ã‘ã§çµæ§‹ã§ã™ã€‚</p>
                `
                ,
                'es': `
                    <p>WhisperLocus es un mapa pÃºblico y anÃ³nimo<br>donde se colocan las palabras, no se intercambian.</p>
                    <p>Existe para pensamientos, recuerdos y sentimientos<br>que nunca encontraron el momento adecuado para expresarse.</p>
                    <p>Todas las publicaciones son anÃ³nimas. Todas las publicaciones son pÃºblicas.<br>Cada una estÃ¡ anclada a un lugar, marcada Ãºnicamente por un cÃ³digo Ãºnico.</p>
                    <p>No hay perfiles, comentarios ni respuestas.<br>Este no es un espacio para debatir, persuadir ni promocionar.</p>
                    <p>Algunas publicaciones pueden ser moderadas o eliminadas si contienen daÃ±o dirigido, publicidad explÃ­cita o mal uso deliberado del espacio.</p>
                    <p>La moderaciÃ³n existe para proteger el silencio,<br>no para moldear lo que se debe sentir.</p>
                    <p class="about-highlight">No tienes que dejar nada aquÃ­.<br>Solo puedes mirar.</p>
                `
                ,
                'ko': `
                    <p>ìœ„ìŠ¤í¼ë¡œì»¤ìŠ¤ëŠ” ìµëª…ìœ¼ë¡œ ìš´ì˜ë˜ëŠ” ê³µê°œ ì§€ë„ì…ë‹ˆë‹¤.<br>ì´ê³³ì—ì„œëŠ” ë‹¨ì–´ë¥¼ êµí™˜í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë°°ì¹˜í•©ë‹ˆë‹¤.</p>
                    <p>ë§í•  ì ì ˆí•œ ìˆœê°„ì„ ì°¾ì§€ ëª»í•œ ìƒê°, ê¸°ì–µ, ê°ì •ì„ ìœ„í•´ ì¡´ì¬í•©ë‹ˆë‹¤.<br></p>
                    <p>ëª¨ë“  ê²Œì‹œë¬¼ì€ ìµëª…ì´ë©° ê³µê°œë©ë‹ˆë‹¤.<br>ê° ê²Œì‹œë¬¼ì€ ê³ ìœ  ì½”ë“œë¡œë§Œ í‘œì‹œë˜ëŠ” íŠ¹ì • ì¥ì†Œì— ê³ ì •ë©ë‹ˆë‹¤.</p>
                    <p>í”„ë¡œí•„, ëŒ“ê¸€, ë‹µê¸€ ê¸°ëŠ¥ì´ ì—†ìŠµë‹ˆë‹¤.<br>ì´ê³³ì€ í† ë¡ , ì„¤ë“, í™ë³´ë¥¼ ìœ„í•œ ê³µê°„ì´ ì•„ë‹™ë‹ˆë‹¤.</p>
                    <p>íŠ¹ì •ì¸ì„ ëŒ€ìƒìœ¼ë¡œ í•œ ì•…ì˜ì ì¸ ë‚´ìš©, ë…¸ê³¨ì ì¸ ê´‘ê³ , ë˜ëŠ” ê³µê°„ì˜ ê³ ì˜ì ì¸ ì˜¤ìš©ì„ í¬í•¨í•˜ëŠ” ê²Œì‹œë¬¼ì€ ê²€í†  í›„ ì‚­ì œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    <p>ê´€ë¦¬ëŠ” ì¹¨ë¬µì„ ë³´í˜¸í•˜ê¸° ìœ„í•œ ê²ƒì´ë©°,<br>ì–´ë–¤ ê°ì •ì„ ëŠê»´ì•¼ í•˜ëŠ”ì§€ë¥¼ ê°•ìš”í•˜ê¸° ìœ„í•œ ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤.</p>
                    <p class="about-highlight">ì—¬ê¸°ì— ì•„ë¬´ê²ƒë„ ë‚¨ê¸°ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.<br>ê·¸ëƒ¥ ë³´ê¸°ë§Œ í•´ë„ ë©ë‹ˆë‹¤.</p>
                `
            };

            // --- 2. åµæ¸¬èªç³»ä¸¦æ³¨å…¥å…§å®¹ ---
            const userLang = navigator.language || navigator.userLanguage;
            const langKey = userLang.startsWith('zh') ? 'zh' : 'en';
            const textContainer = document.getElementById('about-text-container');
            if (textContainer) {
                textContainer.innerHTML = translations[langKey];
            }

            // --- 3. æœå°‹è¨Šæ¯æ§åˆ¶é‚è¼¯ ---
            const msgBox = document.getElementById('code-search-message');
            let hideTimeout = null;

            const startHideTimer = () => {
                if (msgBox.textContent.trim() === "") return;
                if (hideTimeout) clearTimeout(hideTimeout);

                hideTimeout = setTimeout(() => {
                    msgBox.style.opacity = "0";
                    setTimeout(() => {
                        msgBox.textContent = "";
                        msgBox.style.opacity = "1";
                    }, 800);
                }, 4000);
            };

            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            if (code) {
                msgBox.textContent = `æ‰¾åˆ°è²¼æ–‡ "${code}"`;
                startHideTimer();
            }

            const observer = new MutationObserver(() => {
                if (msgBox.textContent.trim() !== "") {
                    msgBox.style.opacity = "1";
                    startHideTimer();
                }
            });
            observer.observe(msgBox, { childList: true, characterData: true, subtree: true });

            // --- 4. About èªªæ˜é¢æ¿æ§åˆ¶é‚è¼¯ ---
            const mainLogo = document.getElementById('main-logo');
            const aboutPanel = document.getElementById('about-panel');
            const aboutClose = document.getElementById('about-close');

            if (mainLogo) {
                mainLogo.addEventListener('click', () => {
                    aboutPanel.classList.remove('hidden');
                    aboutPanel.style.opacity = "1";
                });
            }

            if (aboutClose) {
                aboutClose.addEventListener('click', (e) => {
                    e.stopPropagation();
                    aboutPanel.classList.add('hidden');
                });
            }

            aboutPanel.addEventListener('click', (e) => {
                if (e.target === aboutPanel) {
                    aboutPanel.classList.add('hidden');
                }
            });
        });
    </script>

</body>
</html>