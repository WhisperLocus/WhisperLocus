<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8">
    <title>WhisperLocus</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">

    <script src='https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.css' rel='stylesheet' />
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@600&display=swap" rel="stylesheet">
    
<style>
/* ---------------------------------------------------- */
/* åŸºç¤ä½ˆå±€ */
/* ---------------------------------------------------- */
*, ::before, ::after { box-sizing: border-box; }

html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100vh;
    overflow: hidden; 
    background-color: #f0f0f0;
}

#map-container {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 100%;
    z-index: 1;
}

/* ---------------------------------------------------- */
/* é ‚éƒ¨å°è¦½åˆ—é…ç½® */
/* ---------------------------------------------------- */
#top-navigation {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100px;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 40px;
    pointer-events: none;
}

#top-navigation > * { pointer-events: auto; }

.nav-icon-left {
    background: none;
    border: none;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    gap: 6px;
    padding: 10px;
}

.nav-icon-left span {
    display: block;
    width: 22px;
    height: 1.2px;
    background-color: #333;
    transition: 0.3s;
}

#branding-center { text-align: center; }

#main-logo {
    font-family: 'Cormorant Garamond', serif;
    font-size: 32px;
    font-weight: 600; 
    color: #333;
    margin: 0;
    line-height: 1;
    letter-spacing: 1px;
}

#sub-slogan {
    font-family: 'Arial', sans-serif;
    font-size: 11px;
    color: #555;
    margin: 4px 0 0 0;
    letter-spacing: 0.5px;
}

.nav-icon-right {
    background: none;
    border: none;
    cursor: pointer;
    display: grid;
    grid-template-columns: repeat(3, 4px);
    gap: 4px;
    padding: 10px;
}

.nav-icon-right span {
    display: block;
    width: 4px;
    height: 4px;
    background-color: #333;
    border-radius: 50%;
}

/* ---------------------------------------------------- */
/* å³å´åŠŸèƒ½é¢æ¿ */
/* ---------------------------------------------------- */
#actions-panel {
    position: fixed;
    top: 90px;
    right: 40px;
    width: 250px;
    height: 140px;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.05);
    z-index: 150;
    transform: translateY(-10px);
    opacity: 0;
    visibility: hidden;
    transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
}

#actions-panel.show {
    transform: translateY(0);
    opacity: 1;
    visibility: visible;
}

#leave-post-link {
    display: block;
    width: 100%;
    background-color: #ff5722; 
    color: white; 
    text-decoration: none;
    padding: 12px; 
    border-radius: 6px;
    font-size: 13px;
    text-align: center;
    margin-bottom: 15px;
}

#code-input {
    width: 100%; 
    padding: 12px; 
    font-size: 13px;
    border-radius: 6px; 
    border: 1px solid rgba(0,0,0,0.1); 
    background: white; 
    text-align: center;
    outline: none;
}

#code-search-message {
    font-size: 11px; 
    color: #ff5722;
    margin-top: 10px;
    text-align: center;
    min-height: 15px;
}

/* ---------------------------------------------------- */
/* ğŸ¯ é—œéµï¼šä¿®å¾©å½ˆçª—åœ¨ä¸Šæ–¹ã€ç®­é ­åœ¨ä¸‹æ–¹ç½®ä¸­ */
/* ---------------------------------------------------- */

/* ç•¶å½ˆçª—éŒ¨é»åœ¨åº•éƒ¨æ™‚ï¼ˆå³å½ˆçª—å‡ºç¾åœ¨é»çš„ä¸Šæ–¹ï¼‰ */
.mapboxgl-popup-anchor-bottom {
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important; /* æ°´å¹³ç½®ä¸­å…§å®¹ */
}

/* å¼·åˆ¶ä¸‹æ–¹çš„ç®­é ­ (Tip) ç½®ä¸­ */
.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip {
    align-self: center !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    order: 2; /* ç¢ºä¿ç®­é ­åœ¨å…§å®¹ä¸‹æ–¹ */
}

.mapboxgl-popup-anchor-bottom .mapboxgl-popup-content {
    order: 1; /* ç¢ºä¿å…§å®¹åœ¨ç®­é ­ä¸Šæ–¹ */
}

/* Popup æ¨£å¼è‡ªå®šç¾© */
.custom-memo-popup .mapboxgl-popup-content { 
    background-color: #FFFEF9 !important; 
    border-radius: 2px !important; 
    box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.2) !important; 
    padding: 0 !important; 
    width: 300px !important; 
    min-height: 250px !important; 
    display: flex; 
    flex-direction: column; 
}

.emotion-popup-content-wrapper { padding: 45px 20px 45px 25px; flex-grow: 1; display: flex; flex-direction: column; position: relative; min-height: 250px; box-sizing: border-box;}
.memo-content-text { font-size: 15px; line-height: 1.7; color: #333; white-space: pre-wrap; word-break: break-word; margin-top: auto !important; margin-bottom: auto !important; overflow-y: auto; max-height: 180px; display: block; width: 100%; }
.memo-content-text::before, .memo-content-text::after { content: none !important; display: none !important;}
.popup-code-label, .popup-delete-btn, .popup-location-label, .popup-bottom-right { font-size: 11px; color: #999; position: absolute; font-family: Arial, sans-serif; }
.popup-code-label { top: 15px; left: 20px; }
.popup-delete-btn { top: 15px; right: 20px; cursor: pointer; z-index: 10;}
.popup-location-label { bottom: 15px; left: 20px; color: #777; width: 60%;}
.popup-bottom-right { bottom: 15px; right: 20px; }

/* ---------------------------------------------------- */
/* About é¢æ¿ */
/* ---------------------------------------------------- */
#about-panel {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(1px);
    display: flex; align-items: center; justify-content: center;
    z-index: 2000; opacity: 0; visibility: hidden;
    transition: opacity 0.5s ease;
}
#about-panel.show { opacity: 1; visibility: visible; }
.about-content { position: relative; max-width: 600px; width: 85%; text-align: center; color: #333; line-height: 1.8; }
#about-close { position: absolute; top: -60px; right: 0; background: none; border: none; font-size: 32px; cursor: pointer; color: #999; }
.about-highlight { margin-top: 30px; font-style: italic; font-weight: bold; }

@media (max-width: 480px) {
    #top-navigation { padding: 0 20px; height: 80px; }
    #main-logo { font-size: 26px; }
    #actions-panel { right: 20px; width: calc(100% - 40px); }
}
</style>
</head>

<body>
    <div id="map-container"></div> 
    
    <nav id="top-navigation">
        <button class="nav-icon-left" id="btn-about-trigger">
            <span></span><span></span><span></span>
        </button>
        <div id="branding-center">
            <h1 id="main-logo">WhisperLocus</h1>
            <p id="sub-slogan">For the words we never got to say.</p>
        </div>
        <button class="nav-icon-right" id="btn-actions-trigger">
            <span></span><span></span><span></span>
            <span></span><span></span><span></span>
        </button>
    </nav>

    <div id="actions-panel">
        <a href="post.html" id="leave-post-link">Leave a whisper.</a>
        <form id="code-search-form">
            <input type="text" id="code-input" placeholder="Search by Code" maxlength="8" required autocomplete="off">
            <div id="code-search-message"></div>
        </form>
    </div>

    <div id="about-panel">
        <div class="about-content">
            <button id="about-close">&times;</button>
            <div id="about-text-container"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, deleteDoc, query, where, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDFED1K3dpMYaUpj8DlJWI1SnqgfFWzy44",
            authDomain: "whisperlocus.firebaseapp.com",
            projectId: "whisperlocus",
            storageBucket: "whisperlocus.firebasestorage.app",
            messagingSenderId: "801292984890",
            appId: "1:801292984890:web:0c064b4c206a8000f84b03",
            measurementId: "G-TCB2PWSN1C"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        window.db = db; window.collection = collection; window.getDocs = getDocs; window.doc = doc; window.deleteDoc = deleteDoc; window.query = query; window.where = where; window.serverTimestamp = serverTimestamp;
    </script>

    <script src="map.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const translations = {
                'zh': `
                    <p>WhisperLocus æ˜¯ä¸€å€‹å…¬é–‹çš„åŒ¿ååœ°åœ–ã€‚
                    <p>å®ƒç‚ºé‚£äº›æœªæ›¾æ‰¾åˆ°åˆé©æ™‚æ©Ÿèªªå‡ºå£çš„<br>æ€ç·’ã€è¨˜æ†¶èˆ‡æƒ…æ„Ÿè€Œå­˜åœ¨ã€‚</p>
                    <p>æ¯ä¸€å‰‡è²¼æ–‡éƒ½æ˜¯åŒ¿åçš„ï¼Œ<br>æ¯ä¸€å‰‡è²¼æ–‡éƒ½æ˜¯å…¬é–‹çš„ã€‚<br>å®ƒå€‘éŒ¨å®šæ–¼ç‰¹å®šçš„ç©ºé–“ï¼Œ<br>åƒ…ç”±å”¯ä¸€çš„ä»£ç¢¼æ¨™è¨˜ã€‚</p>
                    <p>é€™è£¡æ²’æœ‰å€‹äººæª”æ¡ˆã€æ²’æœ‰è©•è«–ï¼Œä¹Ÿæ²’æœ‰å›è¦†ã€‚
                    <p>è‹¥è²¼æ–‡åŒ…å«é‡å°æ€§çš„å‚·å®³ã€<br>éœ²éª¨å»£å‘Šæˆ–åˆ»æ„æ¿«ç”¨ï¼Œ<br>å¯èƒ½æœƒè¢«å¯©æ ¸æˆ–ç§»é™¤ã€‚<br>å¯©æ ¸çš„å­˜åœ¨æ˜¯ç‚ºäº†å®ˆè­·é€™ç‰‡å¯§éœã€‚</p>
                    <p class="about-highlight">ä½ å¯ä»¥ä¸åœ¨é€™è£¡ç•™ä¸‹ä»»ä½•æ±è¥¿ï¼Œ<br>åƒ…åƒ…åªæ˜¯ç€è¦½ä¹Ÿæ˜¯æ²’å•é¡Œçš„ã€‚</p>
                `,
                'en': `
                    <p>WhisperLocus is a public, anonymous map<br>where words are placed, not exchanged.</p>
                    <p>It exists for those <br>thoughts, memories and emotions that have never found the right time to express them. </p>
                    <p>Every post is anonymous,<br>Every post is public. <br>They are anchored to a specific space,<br>marked only by a unique code. </p>
                    <p>There are no profiles, no comments, and no replies.</p>
                    <p>Posts that contain targeted harm, <br>explicit advertising, or are intentionally abusive<br> may be reviewed or removed. 
                    <br>The audit exists to protect this tranquility. </p>
                    <p class="about-highlight">You don't have to leave anything here,<br> just browsing is fine. </p>
                `
                ,
                'fr': `
                    <p>WhisperLocus est une carte publique et anonyme<br>oÃ¹ les mots sont placÃ©s et non Ã©changÃ©s.</p> 
                    <p>Il existe pour ces pensÃ©es, souvenirs et Ã©motions qui n'ont jamais trouvÃ© le bon moment pour les exprimer. </p> 
                    <p>Chaque publication est anonyme,<br>Chaque publication est publique. <br>Ils sont ancrÃ©s dans un espace spÃ©cifique,<br>marquÃ© uniquement par un code unique. </p> 
                    <p>Il n'y a aucun profil, aucun commentaire et aucune rÃ©ponse.</p> 
                    <p>Les messages contenant des prÃ©judices ciblÃ©s, <br>de la publicitÃ© explicite ou intentionnellement abusifs<br> peuvent Ãªtre examinÃ©s ou supprimÃ©s. 
                    <br>L'audit existe pour protÃ©ger cette tranquillitÃ©. </p> 
                    <p class="about-highlight">Vous n'Ãªtes pas obligÃ© de laisser quoi que ce soit ici,<br> il suffit de naviguer. </p>
                `
                ,
                'jp': `
                    <p>WhisperLocus ã¯å…¬é–‹ã•ã‚ŒãŸåŒ¿åã®ãƒãƒƒãƒ—ã§ã™<br>ãã“ã§ã¯è¨€è‘‰ãŒäº¤æ›ã•ã‚Œã‚‹ã®ã§ã¯ãªãã€é…ç½®ã•ã‚Œã¾ã™ã€‚</p>
                    <p>ãã‚Œã¯ã€è¡¨ç¾ã™ã‚‹é©åˆ‡ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’è¦‹ã¤ã‘ã‚‰ã‚Œãªã‹ã£ãŸ<br>æ€è€ƒã€è¨˜æ†¶ã€æ„Ÿæƒ…ã®ãŸã‚ã«å­˜åœ¨ã—ã¾ã™ã€‚ </p>
                    <p>ã™ã¹ã¦ã®æŠ•ç¨¿ã¯åŒ¿åã§ã‚ã‚Šã€<br>ã™ã¹ã¦ã®æŠ•ç¨¿ã¯å…¬é–‹ã•ã‚Œã¾ã™ã€‚ <br>ãã‚Œã‚‰ã¯ç‰¹å®šã®ã‚¹ãƒšãƒ¼ã‚¹ã«å›ºå®šã•ã‚Œã¦ãŠã‚Šã€<br>ä¸€æ„ã®ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦ã®ã¿ãƒãƒ¼ã‚¯ã•ã‚Œã¾ã™ã€‚ </p>
                    <p>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã€ã‚³ãƒ¡ãƒ³ãƒˆã€è¿”ä¿¡ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                    <p>å¯¾è±¡ã‚’çµã£ãŸå±å®³ã‚’å«ã‚€æŠ•ç¨¿ã€<br>éœ²éª¨ãªåºƒå‘Šã€ã¾ãŸã¯æ„å›³çš„ã«è™å¾…çš„ãªæŠ•ç¨¿ã¯<br>å¯©æŸ»ã¾ãŸã¯å‰Šé™¤ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ 
                    <br>ç›£æŸ»ã¯ã“ã®å¹³ç©ã‚’å®ˆã‚‹ãŸã‚ã«å­˜åœ¨ã—ã¾ã™ã€‚ </p>
                    <p class="about-highlight">ã“ã“ã«ä½•ã‚‚æ®‹ã™å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br> é–²è¦§ã™ã‚‹ã ã‘ã§å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚ </p>
                `
                ,
                'es': `
                    <p>WhisperLocus es un mapa pÃºblico y anÃ³nimo<br>donde se colocan palabras, no se intercambian.</p> 
                    <p>Existe para aquellos pensamientos, recuerdos y emociones que nunca han encontrado el momento adecuado para expresarlos. </p> 
                    <p>Cada publicaciÃ³n es anÃ³nima,<br>Cada publicaciÃ³n es pÃºblica. <br>EstÃ¡n anclados a un espacio especÃ­fico,<br>marcado Ãºnicamente por un cÃ³digo Ãºnico. </p> 
                    <p>No hay perfiles, ni comentarios, ni respuestas.</p> 
                    <p>Las publicaciones que contengan daÃ±o dirigido, <br>publicidad explÃ­cita o que sean intencionalmente abusivas<br> pueden revisarse o eliminarse. 
                    <br>La auditorÃ­a existe para proteger esta tranquilidad. </p> 
                    <p class="about-highlight">No es necesario que dejes nada aquÃ­,<br> simplemente navegar estÃ¡ bien. </p>
                `
                ,
                'ko': `
                    <p>WhisperLocusëŠ”<br>ë‹¨ì–´ê°€ êµí™˜ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë°°ì¹˜ë˜ëŠ” ê³µê°œ ìµëª… ì§€ë„ì…ë‹ˆë‹¤.</p> 
                    <p>í‘œí˜„í•  ì ì ˆí•œ ì‹œê¸°ë¥¼ ì°¾ì§€ ëª»í•œ <br>ìƒê°, ê¸°ì–µ, ê°ì •ì„ ìœ„í•´ ì¡´ì¬í•©ë‹ˆë‹¤. </p> 
                    <p>ëª¨ë“  ê²Œì‹œë¬¼ì€ ìµëª…ìœ¼ë¡œ ì²˜ë¦¬ë˜ë©°<br>ëª¨ë“  ê²Œì‹œë¬¼ì€ ê³µê°œë©ë‹ˆë‹¤. <br>íŠ¹ì • ê³µê°„ì— ê³ ì •ë˜ì–´ ìˆìœ¼ë©°<br>ê³ ìœ  ì½”ë“œë¡œë§Œ í‘œì‹œë©ë‹ˆë‹¤. </p> 
                    <p>í”„ë¡œí•„ë„ ì—†ê³  ëŒ“ê¸€ë„ ì—†ê³  ë‹µê¸€ë„ ì—†ìŠµë‹ˆë‹¤.</p> 
                    <p>í•´ë¥¼ ë¼ì¹˜ëŠ” ì˜ë„ê°€ í¬í•¨ëœ ê²Œì‹œë¬¼, <br>ë…¸ê³¨ì ì¸ ê´‘ê³  ë˜ëŠ” ì˜ë„ì ì¸ ìš•ì„¤ì´ í¬í•¨ëœ<br> ê²Œì‹œë¬¼ì€ ê²€í† ë˜ê±°ë‚˜ ì‚­ì œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
                    <br>ê°ì‚¬ëŠ” ì´ëŸ¬í•œ í‰ì˜¨í•¨ì„ ì§€í‚¤ê¸° ìœ„í•´ ì¡´ì¬í•©ë‹ˆë‹¤. </p> 
                    <p class="about-highlight">ì—¬ê¸°ì— ì•„ë¬´ê²ƒë„ ë‚¨ê¸¸ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.<br> íƒìƒ‰ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤. </p>
                `
            };
            const userLang = navigator.language || navigator.userLanguage;
            document.getElementById('about-text-container').innerHTML = translations[userLang.startsWith('zh') ? 'zh' : 'en'];

            const btnAbout = document.getElementById('btn-about-trigger');
            const aboutPanel = document.getElementById('about-panel');
            const aboutClose = document.getElementById('about-close');
            const btnActions = document.getElementById('btn-actions-trigger');
            const actionsPanel = document.getElementById('actions-panel');

            btnAbout.addEventListener('click', () => { aboutPanel.classList.add('show'); actionsPanel.classList.remove('show'); });
            aboutClose.addEventListener('click', () => aboutPanel.classList.remove('show'));
            btnActions.addEventListener('click', (e) => { e.stopPropagation(); actionsPanel.classList.toggle('show'); });
            document.addEventListener('click', (e) => { if (!actionsPanel.contains(e.target) && e.target !== btnActions) actionsPanel.classList.remove('show'); });
        });
    </script>
</body>
</html>